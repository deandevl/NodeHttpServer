{"mappings":"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","sources":["src/nodehttpserver.js"],"sourcesContent":["/**\r\n * Created by Rick on 2021-08-29.\r\n */\r\n'use strict';\r\n\r\nconst http = require('http');\r\nconst Buffer = require('buffer');\r\nconst path = require('path');\r\nconst fs = require('fs');\r\nconst EventEmitter = require('events');\r\nconst lodash_set = require('lodash.set');\r\n\r\nconst global_error_emitter = new EventEmitter();\r\nglobal_error_emitter.on('error', async (res,err) => {\r\n  err.statusCode = err.statusCode || 500;\r\n  const content = {\r\n    statusCode: err.statusCode,\r\n    message: err.message\r\n  }\r\n  await reply_response(\r\n    res,\r\n    content.statusCode,\r\n    JSON.stringify(content),\r\n    'application/json'\r\n  );\r\n  if(err.stack !== undefined){\r\n    console.log(err.stack);\r\n  }\r\n});\r\n\r\nclass HttpServer{\r\n  constructor(host, port) {\r\n    this.host = host || process.env.HOST;\r\n    this.port = port || parseInt(process.env.PORT);\r\n    if(this.host === undefined){\r\n      this.host = '127.0.0.1';  // default IPv4 loopback address to the local host\r\n    }\r\n    if(isNaN(this.port)){\r\n      this.port = 8080;\r\n    }\r\n\r\n    this.base = [this.host,':',this.port].join('');\r\n\r\n    this.server = http.createServer();\r\n\r\n    this.methods = {\r\n      get: {},\r\n      post: {},\r\n      patch: {},\r\n      delete: {}\r\n    }\r\n    this.current_route = '/';\r\n    this.middlewares = {};\r\n    this.static_dir = __dirname;\r\n    this.found_file_path = null;\r\n\r\n    this.content_types = {\r\n      '.html': 'text/html',\r\n      '.jpg': 'image/jpeg',\r\n      '.css': 'text/css',\r\n      '.js': 'text/javascript',\r\n      '.png': 'imageg/png',\r\n      '.ico': 'image/x-icon',\r\n      '.json': 'application/json',\r\n      '.svg': 'image/svg+xml',\r\n      '.svgz': 'image/svg+xml'\r\n    }\r\n\r\n    this.server.on('request', this.callback);\r\n  };\r\n  callback = async (req,res) => {\r\n    const method = req.method.toLowerCase();\r\n    // const url_parsed = url.parse(req.url, true);\r\n    // let url_pathname = url_parsed.pathname;\r\n    const url = new URL(req.url, 'http:\\\\' + this.base);\r\n    let url_pathname = url.pathname;\r\n\r\n    // process middleware\r\n    if(Object.keys(this.middlewares).length > 0) {\r\n      //process middleware for '/' routes\r\n      for (let fn of this.middlewares['/']) {\r\n        await fn(req, res);\r\n      }\r\n      // process route specific middleware\r\n      if (Object.keys(this.middlewares).includes(url_pathname)) {\r\n        for (let fn of this.middlewares[url_pathname]) {\r\n          await fn(req, res);\r\n        }\r\n      }\r\n    }\r\n    switch (method) {\r\n      case 'get':\r\n        if (url_pathname in this.methods.get) {\r\n          this.methods.get[url_pathname](req, res);\r\n        } else if(this.static_dir !== null){\r\n          url_pathname = url_pathname.replace('/','');\r\n          const url_parts = url_pathname.split('/');\r\n          const target_file_name = url_parts[url_parts.length-1];\r\n          this.found_file_path = null;\r\n          this._search_file(this.static_dir, target_file_name);\r\n          if(this.found_file_path !== null) {\r\n            const content = await this._read_file(this.found_file_path);\r\n            const content_type = this.content_types[path.extname(this.found_file_path)];\r\n            await reply_response(res, 200, content, content_type);\r\n          }else {\r\n            const err = {\r\n              statusCode: 404,\r\n              message: `Could not locate ${url_pathname} (get)`\r\n            }\r\n            global_error_emitter.emit('error',res,err);\r\n          }\r\n        } else {\r\n          const err = {\r\n            statusCode: 404,\r\n            message: `Could not locate ${url_pathname} (get)`\r\n          }\r\n          global_error_emitter.emit('error',res,err);\r\n        }\r\n        break;\r\n      case 'post':\r\n        if (url_pathname in this.methods.post) {\r\n          this.methods.post[url_pathname](req, res);\r\n        } else {\r\n          const err = {\r\n            statusCode: 404,\r\n            message: `Could not locate ${url_pathname} (post)`\r\n          }\r\n          global_error_emitter.emit('error',res,err);\r\n        }\r\n        break;\r\n      case 'patch':\r\n        if (url_pathname in this.methods.patch) {\r\n          this.methods.patch[url_pathname](req, res);\r\n        } else {\r\n          const err = {\r\n            statusCode: 404,\r\n            message: `Could not locate ${url_pathname} (patch)`\r\n          }\r\n          global_error_emitter.emit('error',res,err);\r\n        }\r\n        break;\r\n      case 'delete':\r\n        if (url_pathname in this.methods.delete) {\r\n          this.methods.delete[url_pathname](req, res);\r\n        } else {\r\n          const err = {\r\n            statusCode: 404,\r\n            message: `Could not locate ${url_pathname} (delete)`\r\n          }\r\n          global_error_emitter.emit('error',res,err);\r\n        }\r\n        break;\r\n      default:\r\n        const err = {\r\n          statusCode: 400,\r\n          message: `Method ${method} is not supported.`\r\n        }\r\n        global_error_emitter.emit('error',res,err);\r\n        break;\r\n    }\r\n  }\r\n\r\n  use({route = '/', middleware = () => {}}) {\r\n    if(!(Object.keys(this.middlewares).includes(route))) {\r\n      this.middlewares[route] = [];\r\n    }\r\n    this.middlewares[route].push(middleware);\r\n  }\r\n  route(a_route){\r\n    this.current_route = a_route;\r\n    return this;\r\n  }\r\n\r\n  add_router(router){\r\n    for(const route of router.methods.get) {\r\n      this.methods.get[route.route] = route.handler;\r\n    }\r\n    for(const route of router.methods.post) {\r\n      this.methods.post[route.route] = route.handler;\r\n    }\r\n    for(const route of router.methods.patch) {\r\n      this.methods.patch[route.route] = route.handler;\r\n    }\r\n    for(const route of router.methods.delete) {\r\n      this.methods.delete[route.route] = route.handler;\r\n    }\r\n  }\r\n\r\n  add_content_type(ext, content_type){\r\n    this.content_types.push({ext:content_type});\r\n  }\r\n\r\n  get({route = this.current_route, handler = () => {}}){\r\n    this.methods.get[route] = handler;\r\n    return this;\r\n  }\r\n  post({route = this.current_route, handler = () => {}}){\r\n    this.methods.post[route] = handler;\r\n    return this;\r\n  }\r\n  patch({route = this.current_route, handler = () => {}}){\r\n    this.methods.patch[route] = handler;\r\n    return this;\r\n  }\r\n  delete({route = this.current_route, handler = () => {}}){\r\n    this.methods.delete[route] = handler;\r\n    return this;\r\n  }\r\n\r\n  listen(message){\r\n    this.server.listen(this.port, this.host, () => {\r\n      console.log(`${message} listening on port ${this.port}`);\r\n    })\r\n    return this.server;\r\n  }\r\n\r\n  static(dir_path) {\r\n    this.static_dir = dir_path;\r\n  }\r\n\r\n  _read_file = (file_path) => {\r\n    return new Promise((resolve, reject) => {\r\n      fs.readFile(file_path, (err,content) => {\r\n        if(err) reject(err);\r\n        resolve(content);\r\n      })\r\n    })\r\n  }\r\n\r\n  _write_file = (file_path, data, flag= 'w') => {\r\n    return new Promise((resolve, reject) => {\r\n      fs.writeFile(file_path, data, {flag: flag}, (err) => {\r\n        if (err) reject(err);\r\n        resolve('ok');\r\n      })\r\n    })\r\n  }\r\n\r\n  _search_file(dir, target_file_name){\r\n    for(const file of fs.readdirSync(dir)){\r\n      const full_path = path.join(dir, file);\r\n      if(fs.lstatSync(full_path).isDirectory()){\r\n        this._search_file(full_path, target_file_name);\r\n      }else{\r\n        if((path.basename(full_path)) === target_file_name){\r\n          this.found_file_path = full_path;\r\n          break;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nconst reply_response = (res, status, content, content_type = 'text/html') => {\r\n  return new Promise((resolve, reject) => {\r\n    res\r\n      .setHeader('Content-Type', content_type)\r\n      .writeHead(status)\r\n      .end(content);\r\n    resolve();\r\n  });\r\n}\r\nconst get_query_str = (req) => {\r\n  return decodeURI(req.url).split('?')[1];\r\n}\r\n\r\nconst get_query_obj = (query_string) => {\r\n  if(query_string === undefined) return {};\r\n\r\n  const query_string_pieces = query_string.split(\"&\");\r\n  const decoded_query_string = {};\r\n\r\n  for(const piece of query_string_pieces){\r\n    const [key, value] = piece.split(\"=\");\r\n    let data = null;\r\n    try {\r\n      const obj_str = '{' + '\"' + key + '\"' + ':' + value + '}';\r\n      data = JSON.parse(obj_str);\r\n    }catch (err){\r\n      const obj_str = '{' + '\"' + key + '\"' + ':' + '\"' + value + '\"' + '}';\r\n      data = JSON.parse(obj_str);\r\n    }\r\n    lodash_set(decoded_query_string, key, data[key]);\r\n  }\r\n  return decoded_query_string;\r\n}\r\n\r\nconst find_object = (array_of_obj, obj_conditions) => {\r\n  const condition_keys = Object.keys(obj_conditions);\r\n  return array_of_obj.filter(obj => {\r\n    return condition_keys.every((key) => obj[key] === obj_conditions[key]);\r\n  });\r\n}\r\n\r\nconst send_404 = async (res, obj) => {\r\n  await reply_response(res, 404, JSON.stringify(obj), 'application/json');\r\n}\r\n\r\nconst get_body = (req) => {\r\n  let body = [];\r\n  return new Promise((resolve, reject) => {\r\n    req.on('data', (chunk) => {\r\n      body.push(chunk);\r\n    }).on('end', () => {\r\n      body = Buffer.concat(body);\r\n      resolve(JSON.parse(body));\r\n    }).on('error', (err) =>{\r\n      reject(err);\r\n    })\r\n  })\r\n}\r\n\r\nconst set_cookies = (res, cookies) => {\r\n  res.setHeader('Set-Cookie', cookies);\r\n}\r\n\r\nclass Router {\r\n  constructor() {\r\n    this.route = undefined;\r\n    this.methods = {\r\n      get: [],\r\n      post: [],\r\n      patch: [],\r\n      delete: []\r\n    }\r\n  }\r\n  set_route(route){\r\n    this.route = route;\r\n    return this;\r\n  }\r\n  get(handler = () => {}){\r\n    this.methods.get.push({\r\n      route: this.route,\r\n      handler: handler\r\n    });\r\n    return this;\r\n  }\r\n  post(handler = () => {}){\r\n    this.methods.post.push({\r\n      route: this.route,\r\n      handler: handler\r\n    });\r\n    return this;\r\n  }\r\n  patch(handler = () => {}){\r\n    this.methods.patch.push({\r\n      route: this.route,\r\n      handler: handler\r\n    });\r\n    return this;\r\n  }\r\n  delete(handler = () => {}){\r\n    this.methods.delete.push({\r\n      route: this.route,\r\n      handler: handler\r\n    });\r\n    return this;\r\n  }\r\n}\r\n\r\nmodule.exports = {\r\n  HttpServer: HttpServer,\r\n  reply_response: reply_response,\r\n  get_query_str: get_query_str,\r\n  get_query_obj: get_query_obj,\r\n  get_body: get_body,\r\n  find_object: find_object,\r\n  send_404: send_404,\r\n  set_cookies: set_cookies,\r\n  global_error_emitter: global_error_emitter,\r\n  Router: Router\r\n}\r\n"],"names":[],"version":3,"file":"main.js.map"}